/*회원 테이블*/
CREATE TABLE member (
    email         VARCHAR2(40) PRIMARY KEY,
    pw            VARCHAR2(20) NOT NULL,
    name          VARCHAR2(10) NOT NULL,
    gender        NUMBER(2),
    birth_year    VARCHAR2(10),
    birth_month   VARCHAR2(10),
    birth_day     VARCHAR2(10),
    phonenumber   VARCHAR2(20),
    address       VARCHAR2(10),
    address1      VARCHAR2(100),
    address2      VARCHAR2(100),
    sms           NUMBER(2),
    auth          VARCHAR2(2) DEFAULT 'N'
);

SELECT
    *
FROM
    member;

/*자료실 테이블*/

CREATE TABLE resource_table (
    res_no          NUMBER(38) PRIMARY KEY,
    res_parentno    NUMBER(38) DEFAULT 0,
    res_title       VARCHAR2(50),
    res_email       VARCHAR2(40),
    res_content     VARCHAR2(1000),
    res_filename    VARCHAR2(50),
    res_writedate   DATE DEFAULT SYSDATE,
    CONSTRAINT res_email_fk FOREIGN KEY ( res_email )
        REFERENCES member ( email )
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    1,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    2,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    3,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    4,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    5,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    6,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    7,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    8,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    9,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    10,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    11,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    12,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    13,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    14,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    15,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    16,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    17,
    'asdf',
    'test@test.com'
);

INSERT INTO resource_table (
    res_no,
    res_title,
    res_email
) VALUES (
    18,
    'asdf',
    'test@test.com'
);

COMMIT;

SELECT
    *
FROM
    resource_table;

SELECT
    *
FROM
    resource_table;

/*자료실 댓글 테이블*/

CREATE TABLE resource_comments (
    co_no        NUMBER(38) PRIMARY KEY,
    res_no       NUMBER(38),
    co_email     VARCHAR2(100),
    co_pw        VARCHAR2(100),
    co_date      DATE DEFAULT SYSDATE,
    co_content   VARCHAR2(1000),
    CONSTRAINT res_no_fk FOREIGN KEY ( res_no )
        REFERENCES resource_table ( res_no )
            ON DELETE CASCADE
);

SELECT
    *
FROM
    resource_comments;

/*이용문의게시판*/

CREATE TABLE question_table (
    ques_no          NUMBER(38) PRIMARY KEY,
    ques_parentno    NUMBER(38) DEFAULT 0,
    ques_title       VARCHAR2(50),
    ques_email       VARCHAR2(40),
    ques_pw          VARCHAR2(20),
    ques_content     VARCHAR2(4000),
    ques_writedate   DATE DEFAULT SYSDATE,
    ques_readcount   NUMBER(38),
    CONSTRAINT ques_email_fk FOREIGN KEY ( ques_email )
        REFERENCES member ( email )
);

SELECT
    *
FROM
    question_table;

/*공지사항*/

CREATE TABLE notice_table (
    noti_no          NUMBER(38) PRIMARY KEY,
    noti_parentno    NUMBER(38) DEFAULT 0,
    noti_title       VARCHAR2(50),
    noti_email       VARCHAR2(40),
    noti_pw          VARCHAR2(20),
    noti_content     VARCHAR2(4000),
    noti_writedate   DATE DEFAULT SYSDATE,
    noti_readcount   NUMBER(38),
    CONSTRAINT noti_email_fk FOREIGN KEY ( noti_email )
        REFERENCES member ( email )
);

SELECT
    *
FROM
    notice_table;

/*강의게시판*/

CREATE TABLE lecture_table (
    lec_no           NUMBER(38) PRIMARY KEY,
    lec_parentno     NUMBER(38) DEFAULT 0,
    lec_title        VARCHAR2(50),
    lec_price        NUMBER(38),
    lec_content      VARCHAR2(4000),
    lec_imgfile      VARCHAR2(50),
    lec_spofile      VARCHAR2(50),
    lec_uploaddate   DATE DEFAULT SYSDATE
);

SELECT
    *
FROM
    (
        SELECT
            ROWNUM AS recnum,
            lvl,
            lec_no,
            lec_parentno,
            lec_title,
            lec_price,
            lec_imgfile,
            lec_spofile
        FROM
            (
                SELECT
                    level AS lvl,
                    lec_no,
                    lec_parentno,
                    lec_title,
                    lec_price,
                    lec_imgfile,
                    lec_spofile
                FROM
                    lecture_table
                START WITH
                    lec_parentno = 0
                CONNECT BY
                    PRIOR lec_no = lec_parentno
                ORDER SIBLINGS BY
                    lec_no DESC
            )
    )
WHERE
    recnum BETWEEN ( 1 - 1 ) * 100 + ( 1 - 1 ) * 10 + 1 AND ( 1 - 1 ) * 100 + 1 * 10;

SELECT
    *
FROM
    lecture_table;

INSERT INTO lecture_table (
    lec_no,
    lec_title,
    lec_price,
    lec_content,
    lec_imgfile,
    lec_spofile
) VALUES (
    1,
    '신쌤 JSP',
    60000,
    'aaaa',
    'alim01.png',
    'alim01.mp4'
);

INSERT INTO lecture_table (
    lec_no,
    lec_title,
    lec_price,
    lec_content,
    lec_imgfile,
    lec_spofile
) VALUES (
    2,
    '동빈나 JAVA',
    60000,
    'aaaa',
    'dongjava01.png',
    'dongjava01.mp4'
);

INSERT INTO lecture_table (
    lec_no,
    lec_title,
    lec_price,
    lec_content,
    lec_imgfile,
    lec_spofile
) VALUES (
    3,
    '정미나 SQL',
    60000,
    'aaaa',
    'jeongsql01.png',
    'jeongsql01.mp4'
);

INSERT INTO lecture_table (
    lec_no,
    lec_title,
    lec_price,
    lec_content,
    lec_imgfile,
    lec_spofile
) VALUES (
    4,
    '리베하얀 CSS',
    60000,
    'aaaa',
    'ricss01.png',
    'ricss01.mp4'
);

SELECT
    *
FROM
    lecture_table;

DROP TABLE lecture_table;

/*교재게시판*/

CREATE TABLE textbook_table (
    book_no           NUMBER(38) PRIMARY KEY,
    book_parentno     NUMBER(38) DEFAULT 0,
    book_title        VARCHAR2(50),
    book_writer       VARCHAR(50),
    book_price        NUMBER(20),
    book_email        VARCHAR2(40),
    book_pw           VARCHAR2(20),
    book_content      VARCHAR2(4000),
    book_filename     VARCHAR2(50),
    book_uploaddate   DATE DEFAULT SYSDATE,
    CONSTRAINT book_email_fk FOREIGN KEY ( book_email )
        REFERENCES member ( email )
);

DROP TABLE textbook_table;


/*장바구니*/

CREATE TABLE cart_table (
    cart_no                   NUMBER(38) PRIMARY KEY,
    cart_email                VARCHAR2(40),
    cart_book1                NUMBER(38),
    cart_book1_num            NUMBER(38),
    cart_book2                NUMBER(38),
    cart_book2_num            NUMBER(38),
    cart_book3                NUMBER(38),
    cart_book3_num            NUMBER(38),
    cart_book4                NUMBER(38),
    cart_book4_num            NUMBER(38),
    cart_book5                NUMBER(38),
    cart_book5_num            NUMBER(38),
    cart_lecture1             NUMBER(38),
    cart_lecture1_startdate   DATE,
    cart_lecture2             NUMBER(38),
    cart_lecture2_startdate   DATE,
    cart_lecture3             NUMBER(38),
    cart_lecture3_startdate   DATE,
    cart_lecture4             NUMBER(38),
    cart_lecture4_startdate   DATE,
    cart_lecture5             NUMBER(38),
    cart_lecture5_startdate   DATE,
    CONSTRAINT cart_email_fk FOREIGN KEY ( cart_email )
        REFERENCES member ( email )
            ON DELETE CASCADE
);

DROP TABLE cart_table;

SELECT
    *
FROM
    cart_table;

/*결제*/

CREATE TABLE payment_table (
    pay_no                   NUMBER(38) PRIMARY KEY,
    pay_cart_no              NUMBER(38),
    pay_email                VARCHAR2(40),
    pay_name                 VARCHAR2(50),
    pay_address              VARCHAR2(50),
    pay_address1             VARCHAR2(50),
    pay_address2             VARCHAR2(50),
    pay_option               VARCHAR2(50),
    pay_total                VARCHAR2(4000),
    pay_book1                NUMBER(38),
    pay_book1_num            NUMBER(38),
    pay_book2                NUMBER(38),
    pay_book2_num            NUMBER(38),
    pay_book3                NUMBER(38),
    pay_book3_num            NUMBER(38),
    pay_book4                NUMBER(38),
    pay_book4_num            NUMBER(38),
    pay_book5                NUMBER(38),
    pay_book5_num            NUMBER(38),
    pay_lecture1             NUMBER(38),
    pay_lecture1_startdate   DATE,
    pay_lecture2             NUMBER(38),
    pay_lecture2_startdate   DATE,
    pay_lecture3             NUMBER(38),
    pay_lecture3_startdate   DATE,
    pay_lecture4             NUMBER(38),
    pay_lecture4_startdate   DATE,
    pay_lecture5             NUMBER(38),
    pay_lecture5_startdate   DATE,
    pay_verify               VARCHAR2(2) DEFAULT 'N',
    CONSTRAINT pay_email_fk FOREIGN KEY ( pay_email )
        REFERENCES member ( email )
);

DROP TABLE payment_table;

SELECT
    *
FROM
    payment_table;

/*
강의 구매 결제 확인 시 insert될 계정별 강의 리스트
create table set_pay_lec_table(
set_no number(3),
set_email varchar2(40),
set_lec_no number(38),
set_lec_title varchar2(50),
set_endDate date,
constraint set_email_fk foreign key(set_email) references member(email)
);
*/

/*회원 삭제시 회원의 장바구니도 함께 삭제*/
/*alter table cart_table add constraint cart_email_fk foreign key(cart_email) references member(email) on delete cascade;*/

/*회원*/

INSERT INTO member (
    email,
    pw,
    name,
    auth
) VALUES (
    'admin@admin.com',
    '1234',
    '관리자',
    'y'
);

INSERT INTO member VALUES (
    'test@test.com',
    '1234',
    '회원1',
    1,
    '2000',
    '12',
    '12',
    '010-1234-5678',
    '47246',
    '부산광역시 부산진구 동천로 109 (부전동, 삼한골든게이트)',
    '아이티윌',
    1,
    'y'
);

INSERT INTO member VALUES (
    'test1@test.com',
    '1234',
    '회원2',
    1,
    '1995',
    '1',
    '11',
    '010-1234-5678',
    '47246',
    '부산광역시 부산진구 동천로 109 (부전동, 삼한골든게이트)',
    '아이티윌',
    1,
    'y'
);